# Common/Default configuration

image:
  repository: ghcr.io/systattic/traversium-moderation-service
  tag: "1.2.0"
  pullPolicy: Always

service:
  port: 8096
  grpcPort: 9090
  type: ClusterIP

replicaCount: 1

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

secrets:
  imagePullSecret: ghcr-secret
  azureModerationSecret: azure-moderation-secret

azure:
  contentSafety:
    endpoint: "https://traversium-moderation.cognitiveservices.azure.com"
    apiVersion: "2024-09-01"

moderation:
  policy:
    blockSeverity: 2

security:
  oauth2:
    resourceserver:
      jwt:
        issuerUri: ""
        audiences: "moderation-service"
  moderation:
    requiredRole: "moderation:access"

resilience4j:
  circuitBreaker:
    azureModeration:
      slidingWindowSize: 10
      failureRateThreshold: 50
      waitDurationInOpenState: 30s
    configs:
      default:
        registerHealthIndicator: true
  retry:
    azureModeration:
      maxAttempts: 2
      waitDuration: 1s
      retryExceptions: "io.grpc.StatusRuntimeException"

probes:
  startup:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  liveness:
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

logging:
  level: INFO

configServer:
  enabled: false
  failFast: false
  bus:
    enabled: true
    refreshEnabled: true
  applicationName: ModerationService

kafka:
  bootstrapServers: "kafka.kafka-test.svc.cluster.local:9092"
